{% extends "web/base.html" %}
{% block title %}Purchase #{{ purchase.id }} — Honey ERP{% endblock %}
{% block content %}
{% include "web/_styles.html" %}

<div class="container py-4 honey-bg rounded">
  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="honey-text mb-0">
      Purchase #{{ purchase.id }} — {{ purchase.farmer.first_name }} {{ purchase.farmer.last_name }}
    </h3>
    <span class="text-muted small">
      Date: {{ purchase.purchase_date|date:"M d, Y H:i" }} |
      Status: <span class="fw-semibold">{{ purchase.get_status_display }}</span>
    </span>
  </div>

  <!-- Items Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Product</th>
          <th class="text-end">Quantity</th>
          <th class="text-end">Unit Price</th>
          <th class="text-end">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        {% for item in purchase.items.all %}
        <tr>
          <td>{{ item.product_name }}</td>
          <td class="text-end">{{ item.quantity }}</td>
          <td class="text-end">{{ item.unit_price }}</td>
          <td class="text-end">{{ item.total_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot class="table-light">
        <tr>
          <th colspan="3" class="text-end">Grand Total</th>
          <th class="text-end">{{ purchase.total_amount }}</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Actions -->
  <div class="d-flex flex-wrap gap-2 mt-3">
    <a class="btn btn-outline-secondary" href="{% url 'purchase_search' %}">
      <i class="ri-arrow-left-line"></i> Back to Search
    </a>
    <a class="btn honey-btn text-white" href="{% url 'add_purchase' purchase.farmer.id %}">
      <i class="ri-add-circle-line"></i> Add More Items
    </a>
    <a class="btn btn-outline-primary" href="{% url 'farmer_purchases' purchase.farmer.id %}">
      <i class="ri-user-line"></i> {{ purchase.farmer.first_name }}'s History
    </a>
    {% if purchase.status == "pending" %}
    {% if designation == "CEO" or designation == "Manager" or designation == "Finance Officer" %}
      <a class="btn btn-success" href="{% url 'mark_purchase_paid' purchase.id %}">
        <i class="ri-check-double-line"></i> Mark as Paid
      </a>
      {% endif %}
      <a class="btn btn-danger" href="{% url 'cancel_purchase' purchase.id %}">
        <i class="ri-close-line"></i> Cancel
      </a>
    {% endif %}
    <a class="btn btn-outline-dark" target="_blank" href="{% url 'print_purchase' purchase.id %}">
      <i class="ri-printer-line"></i> Print
    </a>
  </div>
</div>

<style>
.honey-bg { background: #fffdf6; }
.honey-text { color: #a16207; }
.honey-btn {
  background: #fbbf24;
  border-color: #f59e0b;
}
.honey-btn:hover { opacity:.95; color:#fff; }
.table td, .table th { vertical-align: middle; }
</style>
{% endblock %}
